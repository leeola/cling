<!DOCTYPE html><html lang="en"><head><title>client/sandbox</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="client/sandbox"><meta name="groc-project-path" content="client/sandbox.coffee"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">client/sandbox.coffee</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="sandbox">Sandbox</h1>

<p>Code pertaining to a generic Sandboxing function.</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Set up the eval environment.</p></div></div><div class="code"><div class="wrapper"><span class="nv">SANDBOX_SETUP = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;script&gt;</span>
<span class="s">var MSIE/*@cc_on =1@*/;</span>
<span class="s">parent.__cling.sandbox = MSIE ?</span>
<span class="s">  this :</span>
<span class="s">  { eval: function (code) { return eval(code) }}</span>

<span class="s">/*</span>
<span class="s">// Set up our references.</span>
<span class="s">this.console = {log: parent.__cling.log}</span>
<span class="s">*/</span>
<span class="s">&lt;/script&gt;</span>
<span class="s">&quot;&quot;&quot;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>A class which allows for code isolation inside of an iframe.</p></div></div><div class="code"><div class="wrapper"><span class="k">class</span> <span class="nx">Sandbox</span>
  <span class="nv">constructor: </span><span class="o">-&gt;</span>
    <span class="vi">@_log =</span>
      <span class="nv">console: </span><span class="p">[]</span>
    
    
    <span class="vi">@_iframe = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&#39;iframe&#39;</span>
    <span class="c1">#@_iframe.iframe.style.display = &#39;none&#39;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">@_iframe</span>
    <span class="vi">@_document = </span><span class="nx">frames</span><span class="p">[</span><span class="nx">frames</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nb">document</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Define our object so we can trade some objects between scopes</p></div></div><div class="code"><div class="wrapper">    <span class="nv">cling = </span><span class="nb">window</span><span class="p">.</span><span class="nv">__cling = </span><span class="p">{}</span>
    <span class="nv">cling.console = </span><span class="p">{</span><span class="nv">log: </span><span class="nx">@_consolelog</span><span class="p">}</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Set up our sandbox environment</p></div></div><div class="code"><div class="wrapper">    <span class="nx">@_document</span><span class="p">.</span><span class="nx">write</span> <span class="nx">SANDBOX_SETUP</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>And grab the reference to our sandbox function.</p></div></div><div class="code"><div class="wrapper">    <span class="vi">@__sandbox_eval = </span><span class="nb">window</span><span class="p">.</span><span class="nx">__cling</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nb">eval</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Now remove our cling object from the global environment.</p></div></div><div class="code"><div class="wrapper">    <span class="k">delete</span> <span class="nb">window</span><span class="p">.</span><span class="nx">__cling</span>
  
  <span class="nv">_log: </span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">@_log</span><span class="p">.</span><span class="nx">console</span><span class="p">.</span><span class="nx">push</span> <span class="nx">s</span>
  
  <span class="nb">eval</span><span class="o">:</span> <span class="nf">(code) -&gt;</span>
    <span class="nx">__sandbox_eval</span> <span class="nx">code</span>




<span class="nx">exports</span><span class="p">.</span><span class="nx">Sandbox</span></div></div></div></div></body></html>